import{j as e}from"./query-DCZjxv-P.js";import{r as o,k as Z,j as ee}from"./vendor-rrO37E5y.js";import{C as D,d as A}from"./card-DwHXhc3O.js";import{I as te}from"./input-BbaI2hjk.js";import{S}from"./skeleton-evsicLD4.js";import{e as se,P as O,f as ne,g as ae,h as re,i as oe,j as le,k as ce,c as w,b as ie,B as de,l as me,C as U}from"./index-CykV7N1A.js";import{b as h,f as F}from"./formatters-Lk1sxCTq.js";import{B as b}from"./badge-C6bK7CU_.js";import{g as T}from"./campus-utils-BB5xlZc1.js";import"./firebase-Cbh-IGzk.js";import"./charts-DxkWeNkm.js";var E="Collapsible",[xe]=ce(E),[ue,P]=xe(E),G=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,open:l,defaultOpen:a,disabled:s,onOpenChange:d,...c}=t,[x,p]=se({prop:l,defaultProp:a??!1,onChange:d,caller:E});return e.jsx(ue,{scope:i,disabled:s,contentId:ne(),open:x,onOpenToggle:o.useCallback(()=>p(j=>!j),[p]),children:e.jsx(O.div,{"data-state":I(x),"data-disabled":s?"":void 0,...c,ref:r})})});G.displayName=E;var q="CollapsibleTrigger",H=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,...l}=t,a=P(q,i);return e.jsx(O.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":I(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...l,ref:r,onClick:ae(t.onClick,a.onOpenToggle)})});H.displayName=q;var M="CollapsibleContent",V=o.forwardRef((t,r)=>{const{forceMount:i,...l}=t,a=P(M,t.__scopeCollapsible);return e.jsx(re,{present:i||a.open,children:({present:s})=>e.jsx(he,{...l,ref:r,present:s})})});V.displayName=M;var he=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,present:l,children:a,...s}=t,d=P(M,i),[c,x]=o.useState(l),p=o.useRef(null),j=oe(r,p),C=o.useRef(0),k=C.current,v=o.useRef(0),R=v.current,N=d.open||c,y=o.useRef(N),f=o.useRef(void 0);return o.useEffect(()=>{const m=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(m)},[]),le(()=>{const m=p.current;if(m){f.current=f.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const g=m.getBoundingClientRect();C.current=g.height,v.current=g.width,y.current||(m.style.transitionDuration=f.current.transitionDuration,m.style.animationName=f.current.animationName),x(l)}},[d.open,l]),e.jsx(O.div,{"data-state":I(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!N,...s,ref:j,style:{"--radix-collapsible-content-height":k?`${k}px`:void 0,"--radix-collapsible-content-width":R?`${R}px`:void 0,...t.style},children:N&&a})});function I(t){return t?"open":"closed"}var pe=G;const fe=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],ge=w("arrow-up-down",fe);const je=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],z=w("chevron-right",je);const Ne=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],be=w("search",Ne);const Ce=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ve=w("user",Ce);const ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],we=w("users",ye);function Y({...t}){return e.jsx(pe,{"data-slot":"collapsible",...t})}function J({...t}){return e.jsx(H,{"data-slot":"collapsible-trigger",...t})}function K({...t}){return e.jsx(V,{"data-slot":"collapsible-content",...t})}function Ue(){const{selectedYear:t}=Z(),{data:r,isLoading:i,error:l}=ie(t),a=ee(),[s,d]=o.useState(""),[c,x]=o.useState("totalEnrollment"),[p,j]=o.useState("desc"),[C,k]=o.useState(!0),[v,R]=o.useState(!0);if(i)return e.jsx(Ee,{});if(l||!r?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No campus data available"})});const N=Object.entries(r.snapshot.byCampus).map(([n,u])=>({key:n,...u})).filter(n=>n.campusName.toLowerCase().includes(s.toLowerCase())||n.mcLeader.toLowerCase().includes(s.toLowerCase())).sort((n,u)=>{const _=n[c],$=u[c],L=p==="asc"?1:-1;if(typeof _=="string"){const B=_.localeCompare($);return B===0&&c==="campusName"?L*n.mcLeader.localeCompare(u.mcLeader):L*B}return L*(_-$)}),{branch:y,microCampus:f}=T(N),m=Object.entries(r.snapshot.byCampus).map(([n,u])=>({key:n,...u})),g=T(m),W=g.branch.length+g.microCampus.length,X=n=>{c===n?j(u=>u==="asc"?"desc":"asc"):(x(n),j("desc"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Campuses"}),e.jsx(b,{variant:"outline",className:"text-base px-2.5 py-0.5",children:W})]}),e.jsxs("p",{className:"text-muted-foreground",children:[g.branch.length," branch · ",g.microCampus.length," micro-campus — ",t]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Search campuses...",value:s,onChange:n=>d(n.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Sort by:",["campusName","totalEnrollment","retentionRate"].map(n=>e.jsxs(de,{variant:c===n?"secondary":"ghost",size:"sm",onClick:()=>X(n),className:"h-7 text-xs",children:[n==="campusName"?"Name":n==="totalEnrollment"?"Enrollment":"Retention",c===n&&e.jsx(ge,{className:"ml-1 h-3 w-3"})]},n))]})]}),y.length>0&&e.jsx(ke,{title:"Branch Campuses",icon:e.jsx(me,{className:"h-5 w-5"}),campuses:y,isOpen:C,onToggle:()=>k(!C),onCampusClick:n=>a(`/dashboard/campus/${encodeURIComponent(n)}`)}),f.length>0&&e.jsx(Re,{campuses:f,isOpen:v,onToggle:()=>R(!v),onCampusClick:n=>a(`/dashboard/campus/${encodeURIComponent(n)}`)}),N.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No campuses found matching your search"})]})}function ke({title:t,icon:r,campuses:i,isOpen:l,onToggle:a,onCampusClick:s}){const d=i.reduce((c,x)=>c+x.totalEnrollment,0);return e.jsxs(Y,{open:l,onOpenChange:a,children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full text-left p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[l?e.jsx(U,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),r,e.jsx("span",{className:"text-lg font-semibold",children:t}),e.jsx(b,{variant:"secondary",className:"ml-2",children:i.length}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:[h(d)," total enrolled"]})]})}),e.jsx(K,{children:e.jsx("div",{className:"grid gap-1 pt-1 pl-8",children:i.map(c=>e.jsx(Se,{campus:c,onClick:()=>s(c.key)},c.key))})})]})}function Re({campuses:t,isOpen:r,onToggle:i,onCampusClick:l}){const a=t.reduce((s,d)=>s+d.totalEnrollment,0);return e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full text-left p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[r?e.jsx(U,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(we,{className:"h-5 w-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Micro-Campuses"}),e.jsx(b,{variant:"secondary",className:"ml-2",children:t.length}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:[h(a)," total enrolled"]})]})}),e.jsx(K,{children:e.jsx("div",{className:"grid gap-1 pt-1 pl-8",children:t.map(s=>e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>l(s.key),children:e.jsx(A,{className:"px-3 py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ve,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("p",{className:"font-medium text-sm truncate",children:s.mcLeader||"Unknown Leader"}),e.jsx(Q,{enrollment:s.totalEnrollment})]})}),e.jsxs("div",{className:"flex items-center gap-5 text-sm shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Enrolled"}),e.jsx("p",{className:"font-semibold",children:h(s.totalEnrollment)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Returning"}),e.jsx("p",{className:"font-semibold",children:h(s.returningStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"New"}),e.jsx("p",{className:"font-semibold",children:h(s.newStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention"}),e.jsx("p",{className:`font-semibold ${s.retentionRate>=80?"text-success":s.retentionRate>=60?"text-warning":"text-destructive"}`,children:F(s.retentionRate)})]})]})]})})},s.key))})})]})}function Se({campus:t,onClick:r}){return e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:r,children:e.jsx(A,{className:"px-3 py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.campusName}),e.jsx(Q,{enrollment:t.totalEnrollment})]}),t.mcLeader&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.mcLeader})]}),e.jsxs("div",{className:"flex items-center gap-5 text-sm shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Enrolled"}),e.jsx("p",{className:"font-semibold",children:h(t.totalEnrollment)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Returning"}),e.jsx("p",{className:"font-semibold",children:h(t.returningStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"New"}),e.jsx("p",{className:"font-semibold",children:h(t.newStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention"}),e.jsx("p",{className:`font-semibold ${t.retentionRate>=80?"text-success":t.retentionRate>=60?"text-warning":"text-destructive"}`,children:F(t.retentionRate)})]})]})]})})})}function Q({enrollment:t}){return t>=50?e.jsx(b,{className:"bg-chart-1/15 text-chart-1 border-chart-1/30 hover:bg-chart-1/15 text-xs",children:"Large"}):t>=19?e.jsx(b,{className:"bg-chart-2/15 text-chart-2 border-chart-2/30 hover:bg-chart-2/15 text-xs",children:"Medium"}):e.jsx(b,{className:"bg-chart-3/15 text-chart-3 border-chart-3/30 hover:bg-chart-3/15 text-xs",children:"Small"})}function Ee(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(S,{className:"h-9 w-48"}),e.jsx(S,{className:"h-5 w-64 mt-2"})]}),e.jsx(S,{className:"h-10 w-64"}),e.jsx(S,{className:"h-96"})]})}export{Ue as CampusesPage};
