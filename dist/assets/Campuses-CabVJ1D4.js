import{j as e}from"./query-PEscxNU0.js";import{r,k as F,j as q}from"./vendor-rrO37E5y.js";import{C as U,d as G}from"./card-CvKyquMr.js";import{I as V}from"./input-plEALA3f.js";import{S as y}from"./skeleton-NRffPWfo.js";import{u as z,b as w,f as H}from"./useDashboardData--dUiMfac.js";import{b as Y,P as _,d as J,e as K,f as Q,g as W,h as X,i as Z,c as k,B as ee,j as te,C as se}from"./index-Rivh-WXP.js";import{B as R}from"./badge-CDLwJsqM.js";import{g as ae}from"./campus-utils-CCZNi6hh.js";import"./firebase-Cbh-IGzk.js";import"./charts-DxkWeNkm.js";var S="Collapsible",[ne]=Z(S),[re,O]=ne(S),T=r.forwardRef((t,c)=>{const{__scopeCollapsible:l,open:o,defaultOpen:n,disabled:i,onOpenChange:m,...a}=t,[u,p]=Y({prop:o,defaultProp:n??!1,onChange:m,caller:S});return e.jsx(re,{scope:l,disabled:i,contentId:J(),open:u,onOpenToggle:r.useCallback(()=>p(x=>!x),[p]),children:e.jsx(_.div,{"data-state":I(u),"data-disabled":i?"":void 0,...a,ref:c})})});T.displayName=S;var $="CollapsibleTrigger",D=r.forwardRef((t,c)=>{const{__scopeCollapsible:l,...o}=t,n=O($,l);return e.jsx(_.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":I(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...o,ref:c,onClick:K(t.onClick,n.onOpenToggle)})});D.displayName=$;var P="CollapsibleContent",A=r.forwardRef((t,c)=>{const{forceMount:l,...o}=t,n=O(P,t.__scopeCollapsible);return e.jsx(Q,{present:l||n.open,children:({present:i})=>e.jsx(oe,{...o,ref:c,present:i})})});A.displayName=P;var oe=r.forwardRef((t,c)=>{const{__scopeCollapsible:l,present:o,children:n,...i}=t,m=O(P,l),[a,u]=r.useState(o),p=r.useRef(null),x=W(c,p),g=r.useRef(0),b=g.current,j=r.useRef(0),v=j.current,f=m.open||a,N=r.useRef(f),h=r.useRef(void 0);return r.useEffect(()=>{const d=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(d)},[]),X(()=>{const d=p.current;if(d){h.current=h.current||{transitionDuration:d.style.transitionDuration,animationName:d.style.animationName},d.style.transitionDuration="0s",d.style.animationName="none";const s=d.getBoundingClientRect();g.current=s.height,j.current=s.width,N.current||(d.style.transitionDuration=h.current.transitionDuration,d.style.animationName=h.current.animationName),u(o)}},[m.open,o]),e.jsx(_.div,{"data-state":I(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!f,...i,ref:x,style:{"--radix-collapsible-content-height":b?`${b}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:f&&n})});function I(t){return t?"open":"closed"}var le=T;const ce=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],ie=k("arrow-up-down",ce);const de=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],me=k("chevron-right",de);const ue=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],pe=k("search",ue);const he=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xe=k("users",he);function fe({...t}){return e.jsx(le,{"data-slot":"collapsible",...t})}function ge({...t}){return e.jsx(D,{"data-slot":"collapsible-trigger",...t})}function je({...t}){return e.jsx(A,{"data-slot":"collapsible-content",...t})}function Ie(){const{selectedYear:t}=F(),{data:c,isLoading:l,error:o}=z(t),n=q(),[i,m]=r.useState(""),[a,u]=r.useState("totalEnrollment"),[p,x]=r.useState("desc"),[g,b]=r.useState(!0),[j,v]=r.useState(!0);if(l)return e.jsx(Ce,{});if(o||!c?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No campus data available"})});const f=Object.entries(c.snapshot.byCampus).map(([s,C])=>({key:s,...C})).filter(s=>s.campusName.toLowerCase().includes(i.toLowerCase())||s.mcLeader.toLowerCase().includes(i.toLowerCase())).sort((s,C)=>{const E=s[a],L=C[a],M=p==="asc"?1:-1;return typeof E=="string"?M*E.localeCompare(L):M*(E-L)}),{branch:N,microCampus:h}=ae(f),d=s=>{a===s?x(C=>C==="asc"?"desc":"asc"):(u(s),x("desc"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Campuses"}),e.jsxs("p",{className:"text-muted-foreground",children:["Campus-level metrics for ",t]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search campuses...",value:i,onChange:s=>m(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Sort by:",["campusName","totalEnrollment","retentionRate"].map(s=>e.jsxs(ee,{variant:a===s?"secondary":"ghost",size:"sm",onClick:()=>d(s),className:"h-7 text-xs",children:[s==="campusName"?"Name":s==="totalEnrollment"?"Enrollment":"Retention",a===s&&e.jsx(ie,{className:"ml-1 h-3 w-3"})]},s))]})]}),N.length>0&&e.jsx(B,{title:"Branch Campuses",icon:e.jsx(te,{className:"h-5 w-5"}),campuses:N,isOpen:g,onToggle:()=>b(!g),onCampusClick:s=>n(`/dashboard/campus/${encodeURIComponent(s)}`)}),h.length>0&&e.jsx(B,{title:"Micro-Campuses",icon:e.jsx(xe,{className:"h-5 w-5"}),campuses:h,isOpen:j,onToggle:()=>v(!j),onCampusClick:s=>n(`/dashboard/campus/${encodeURIComponent(s)}`)}),f.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No campuses found matching your search"})]})}function B({title:t,icon:c,campuses:l,isOpen:o,onToggle:n,onCampusClick:i}){const m=l.reduce((a,u)=>a+u.totalEnrollment,0);return e.jsxs(fe,{open:o,onOpenChange:n,children:[e.jsx(ge,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full text-left p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[o?e.jsx(se,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(me,{className:"h-5 w-5 text-muted-foreground"}),c,e.jsx("span",{className:"text-lg font-semibold",children:t}),e.jsx(R,{variant:"secondary",className:"ml-2",children:l.length}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:[w(m)," total enrolled"]})]})}),e.jsx(je,{children:e.jsx("div",{className:"grid gap-3 pt-2 pl-8",children:l.map(a=>e.jsx(U,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>i(a.key),children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:a.campusName}),e.jsx(Ne,{enrollment:a.totalEnrollment})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.mcLeader})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Enrolled"}),e.jsx("p",{className:"font-semibold",children:w(a.totalEnrollment)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Returning"}),e.jsx("p",{className:"font-semibold",children:w(a.returningStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"New"}),e.jsx("p",{className:"font-semibold",children:w(a.newStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention"}),e.jsx("p",{className:`font-semibold ${a.retentionRate>=80?"text-success":a.retentionRate>=60?"text-warning":"text-destructive"}`,children:H(a.retentionRate)})]})]})]})})},a.key))})})]})}function Ne({enrollment:t}){return t>=50?e.jsx(R,{className:"bg-chart-1/15 text-chart-1 border-chart-1/30 hover:bg-chart-1/15 text-xs",children:"Large"}):t>=19?e.jsx(R,{className:"bg-chart-2/15 text-chart-2 border-chart-2/30 hover:bg-chart-2/15 text-xs",children:"Medium"}):e.jsx(R,{className:"bg-chart-3/15 text-chart-3 border-chart-3/30 hover:bg-chart-3/15 text-xs",children:"Small"})}function Ce(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(y,{className:"h-9 w-48"}),e.jsx(y,{className:"h-5 w-64 mt-2"})]}),e.jsx(y,{className:"h-10 w-64"}),e.jsx(y,{className:"h-96"})]})}export{Ie as CampusesPage};
