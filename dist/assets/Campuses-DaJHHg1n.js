import{j as e}from"./query-DCZjxv-P.js";import{r as o,k as Z,j as ee}from"./vendor-rrO37E5y.js";import{i as te,P as O,j as se,k as ne,l as ae,m as re,n as oe,o as le,e as w,g as ce,B as ie,p as de,q as T,C as D,d as U}from"./index-CRNysr_W.js";import{I as me}from"./input-_uFETbBy.js";import{S}from"./skeleton-BJdrlhLC.js";import{b as u,f as q}from"./formatters-Lk1sxCTq.js";import{B as p}from"./badge-BvtS4cbZ.js";import{g as B}from"./campus-utils-BB5xlZc1.js";import"./firebase-Cbh-IGzk.js";import"./charts-DxkWeNkm.js";var E="Collapsible",[xe]=le(E),[he,P]=xe(E),F=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,open:l,defaultOpen:a,disabled:s,onOpenChange:d,...c}=t,[x,g]=te({prop:l,defaultProp:a??!1,onChange:d,caller:E});return e.jsx(he,{scope:i,disabled:s,contentId:se(),open:x,onOpenToggle:o.useCallback(()=>g(j=>!j),[g]),children:e.jsx(O.div,{"data-state":I(x),"data-disabled":s?"":void 0,...c,ref:r})})});F.displayName=E;var G="CollapsibleTrigger",H=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,...l}=t,a=P(G,i);return e.jsx(O.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":I(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...l,ref:r,onClick:ne(t.onClick,a.onOpenToggle)})});H.displayName=G;var M="CollapsibleContent",V=o.forwardRef((t,r)=>{const{forceMount:i,...l}=t,a=P(M,t.__scopeCollapsible);return e.jsx(ae,{present:i||a.open,children:({present:s})=>e.jsx(ue,{...l,ref:r,present:s})})});V.displayName=M;var ue=o.forwardRef((t,r)=>{const{__scopeCollapsible:i,present:l,children:a,...s}=t,d=P(M,i),[c,x]=o.useState(l),g=o.useRef(null),j=re(r,g),C=o.useRef(0),k=C.current,v=o.useRef(0),R=v.current,b=d.open||c,y=o.useRef(b),f=o.useRef(void 0);return o.useEffect(()=>{const m=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(m)},[]),oe(()=>{const m=g.current;if(m){f.current=f.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const N=m.getBoundingClientRect();C.current=N.height,v.current=N.width,y.current||(m.style.transitionDuration=f.current.transitionDuration,m.style.animationName=f.current.animationName),x(l)}},[d.open,l]),e.jsx(O.div,{"data-state":I(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!b,...s,ref:j,style:{"--radix-collapsible-content-height":k?`${k}px`:void 0,"--radix-collapsible-content-width":R?`${R}px`:void 0,...t.style},children:b&&a})});function I(t){return t?"open":"closed"}var pe=F;const ge=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],fe=w("arrow-up-down",ge);const Ne=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],z=w("chevron-right",Ne);const je=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],be=w("search",je);const Ce=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ve=w("user",Ce);const ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],we=w("users",ye);function Y({...t}){return e.jsx(pe,{"data-slot":"collapsible",...t})}function J({...t}){return e.jsx(H,{"data-slot":"collapsible-trigger",...t})}function K({...t}){return e.jsx(V,{"data-slot":"collapsible-content",...t})}function De(){const{selectedYear:t}=Z(),{data:r,isLoading:i,error:l}=ce(t),a=ee(),[s,d]=o.useState(""),[c,x]=o.useState("totalEnrollment"),[g,j]=o.useState("desc"),[C,k]=o.useState(!0),[v,R]=o.useState(!0);if(i)return e.jsx(Ee,{});if(l||!r?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No campus data available"})});const b=Object.entries(r.snapshot.byCampus).map(([n,h])=>({key:n,...h})).filter(n=>n.campusName.toLowerCase().includes(s.toLowerCase())||n.mcLeader.toLowerCase().includes(s.toLowerCase())).sort((n,h)=>{const _=n[c],$=h[c],L=g==="asc"?1:-1;if(typeof _=="string"){const A=_.localeCompare($);return A===0&&c==="campusName"?L*n.mcLeader.localeCompare(h.mcLeader):L*A}return L*(_-$)}),{branch:y,microCampus:f}=B(b),m=Object.entries(r.snapshot.byCampus).map(([n,h])=>({key:n,...h})),N=B(m),W=N.branch.length+N.microCampus.length,X=n=>{c===n?j(h=>h==="asc"?"desc":"asc"):(x(n),j("desc"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Campuses"}),e.jsx(p,{variant:"outline",className:"text-base px-2.5 py-0.5",children:W})]}),e.jsxs("p",{className:"text-muted-foreground",children:[N.branch.length," branch · ",N.microCampus.length," micro-campus — ",t]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:"Search campuses...",value:s,onChange:n=>d(n.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Sort by:",["campusName","totalEnrollment","retentionRate"].map(n=>e.jsxs(ie,{variant:c===n?"secondary":"ghost",size:"sm",onClick:()=>X(n),className:"h-7 text-xs",children:[n==="campusName"?"Name":n==="totalEnrollment"?"Enrollment":"Retention",c===n&&e.jsx(fe,{className:"ml-1 h-3 w-3"})]},n))]})]}),y.length>0&&e.jsx(ke,{title:"Branch Campuses",icon:e.jsx(de,{className:"h-5 w-5"}),campuses:y,isOpen:C,onToggle:()=>k(!C),onCampusClick:n=>a(`/dashboard/campus/${encodeURIComponent(n)}`)}),f.length>0&&e.jsx(Re,{campuses:f,isOpen:v,onToggle:()=>R(!v),onCampusClick:n=>a(`/dashboard/campus/${encodeURIComponent(n)}`)}),b.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No campuses found matching your search"})]})}function ke({title:t,icon:r,campuses:i,isOpen:l,onToggle:a,onCampusClick:s}){const d=i.reduce((c,x)=>c+x.totalEnrollment,0);return e.jsxs(Y,{open:l,onOpenChange:a,children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full text-left p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[l?e.jsx(T,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),r,e.jsx("span",{className:"text-lg font-semibold",children:t}),e.jsx(p,{variant:"secondary",className:"ml-2",children:i.length}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:[u(d)," total enrolled"]})]})}),e.jsx(K,{children:e.jsx("div",{className:"grid gap-1 pt-1 pl-8",children:i.map(c=>e.jsx(Se,{campus:c,onClick:()=>s(c.key)},c.key))})})]})}function Re({campuses:t,isOpen:r,onToggle:i,onCampusClick:l}){const a=t.reduce((s,d)=>s+d.totalEnrollment,0);return e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full text-left p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[r?e.jsx(T,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(z,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(we,{className:"h-5 w-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Micro-Campuses"}),e.jsx(p,{variant:"secondary",className:"ml-2",children:t.length}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:[u(a)," total enrolled"]})]})}),e.jsx(K,{children:e.jsx("div",{className:"grid gap-1 pt-1 pl-8",children:t.map(s=>e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>l(s.key),children:e.jsx(U,{className:"px-3 py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ve,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("p",{className:"font-medium text-sm truncate",children:s.mcLeader||"Unknown Leader"}),e.jsx(Q,{enrollment:s.totalEnrollment}),s.isNewCampus&&e.jsx(p,{className:"bg-primary/15 text-primary border-primary/30 hover:bg-primary/15 text-xs",children:"New"})]})}),e.jsxs("div",{className:"flex items-center gap-5 text-sm shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Enrolled"}),e.jsx("p",{className:"font-semibold",children:u(s.totalEnrollment)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Returning"}),e.jsx("p",{className:"font-semibold",children:u(s.returningStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"New"}),e.jsx("p",{className:"font-semibold",children:u(s.newStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention"}),s.isNewCampus?e.jsx("p",{className:"font-semibold text-muted-foreground",children:"N/A"}):e.jsx("p",{className:`font-semibold ${s.retentionRate>=80?"text-success":s.retentionRate>=60?"text-warning":"text-destructive"}`,children:q(s.retentionRate)})]})]})]})})},s.key))})})]})}function Se({campus:t,onClick:r}){return e.jsx(D,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:r,children:e.jsx(U,{className:"px-3 py-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.campusName}),e.jsx(Q,{enrollment:t.totalEnrollment}),t.isNewCampus&&e.jsx(p,{className:"bg-primary/15 text-primary border-primary/30 hover:bg-primary/15 text-xs",children:"New"})]}),t.mcLeader&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.mcLeader})]}),e.jsxs("div",{className:"flex items-center gap-5 text-sm shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Enrolled"}),e.jsx("p",{className:"font-semibold",children:u(t.totalEnrollment)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Returning"}),e.jsx("p",{className:"font-semibold",children:u(t.returningStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"New"}),e.jsx("p",{className:"font-semibold",children:u(t.newStudents)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention"}),t.isNewCampus?e.jsx("p",{className:"font-semibold text-muted-foreground",children:"N/A"}):e.jsx("p",{className:`font-semibold ${t.retentionRate>=80?"text-success":t.retentionRate>=60?"text-warning":"text-destructive"}`,children:q(t.retentionRate)})]})]})]})})})}function Q({enrollment:t}){return t>=50?e.jsx(p,{className:"bg-chart-1/15 text-chart-1 border-chart-1/30 hover:bg-chart-1/15 text-xs",children:"Large"}):t>=19?e.jsx(p,{className:"bg-chart-2/15 text-chart-2 border-chart-2/30 hover:bg-chart-2/15 text-xs",children:"Medium"}):e.jsx(p,{className:"bg-chart-3/15 text-chart-3 border-chart-3/30 hover:bg-chart-3/15 text-xs",children:"Small"})}function Ee(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(S,{className:"h-9 w-48"}),e.jsx(S,{className:"h-5 w-64 mt-2"})]}),e.jsx(S,{className:"h-10 w-64"}),e.jsx(S,{className:"h-96"})]})}export{De as CampusesPage};
