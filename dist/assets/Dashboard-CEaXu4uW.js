import{j as e}from"./query-PEscxNU0.js";import{C as g,a as j,b as v,d as f}from"./card-D22e-ND2.js";import{c as b,T as Y,a as x}from"./index-BZqu9AQG.js";import{f as y,a as h,b as p,u as E,c as L}from"./useDashboardData-DJulAQGu.js";import{R as k}from"./RetentionGauge-BtYn-TtH.js";import{R as P,P as D,a as A,C as G,T as O,L as V}from"./charts-mYDaWYVf.js";import{S as m}from"./skeleton-BS6LU72D.js";import{k as _}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const $=[["path",{d:"M5 12h14",key:"1ays0h"}]],B=b("minus",$);const F=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],M=b("trending-down",F);function c({title:r,value:s,previousValue:o,format:i="number",description:d,className:l}){const n=i==="percent"?y(s):i==="currency"?h(s):p(s),t=o!==void 0?(s-o)/o*100:null,u=t===null?null:t>0?Y:t<0?M:B;return e.jsxs(g,{className:x("",l),children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:r}),u&&e.jsx(u,{className:x("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n}),t!==null&&e.jsxs("p",{className:x("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),d&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d})]})]})}function W({internalGrowth:r,newCampusGrowth:s}){const o=r+s,i=[{name:"Returning Campuses",value:r,percent:o>0?r/o*100:0},{name:"New Campuses",value:s,percent:o>0?s/o*100:0}],d=["hsl(var(--chart-2))","hsl(var(--chart-3))"];return e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(v,{children:"Growth Breakdown"})}),e.jsxs(f,{children:[e.jsx("div",{className:"h-[250px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(D,{children:[e.jsx(A,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:i.map((l,n)=>e.jsx(G,{fill:d[n%d.length]},l.name))}),e.jsx(O,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(l,n)=>[`${p(l)} (${y(i.find(t=>t.name===n)?.percent||0)})`,n]}),e.jsx(V,{})]})})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:p(o)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total New Students"})]})]})]})}function te(){const{selectedYear:r}=_(),{data:s,isLoading:o,error:i}=E(r),{data:d}=L(r);if(o)return e.jsx(I,{});if(i)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!s?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",r]})});const{snapshot:l,settings:n}=s,t=l.metrics,u=n.activeSchoolYears[n.activeSchoolYears.indexOf(r)-1],a=d?.snapshots?.[u]?.metrics,N=n.fundingByYear?.[r],C=n.erbocesPerStudentCost*t.totalEnrollment,R=N??C,w=N!=null,T=u?n.fundingByYear?.[u]:void 0,S=a?T??n.erbocesPerStudentCost*a.totalEnrollment:void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",r," • Last updated: ",new Date(l.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(c,{title:"Total Enrollment",value:t.totalEnrollment,previousValue:a?.totalEnrollment}),e.jsx(c,{title:"Returning Students",value:t.returningStudents,previousValue:a?.returningStudents}),e.jsx(c,{title:"New Students",value:t.totalNewGrowth,previousValue:a?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(c,{title:"Net Growth",value:t.netGrowth,previousValue:a?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(k,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:a?a.totalEnrollment-(a.verifiedTransfers||0):t.returningStudents}),e.jsx(W,{internalGrowth:t.internalGrowth,newCampusGrowth:t.newCampusGrowth}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs(v,{children:["ERBOCES ",w?"Total":"Projected"," Revenue"]})}),e.jsxs(f,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:h(R)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:w?"Actual total funding":`${t.totalEnrollment.toLocaleString()} students × $${n.erbocesPerStudentCost.toLocaleString()}/student`}),S&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",h(S)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(c,{title:"Non-Starters",value:t.nonStarters,previousValue:a?.nonStarters,description:"Enrolled but never attended"}),e.jsx(c,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:a?.midYearWithdrawals,description:"Left after attending"}),e.jsx(c,{title:"Total Attrition",value:t.attritionTotal,previousValue:a?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function I(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{className:"h-9 w-64"}),e.jsx(m,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((r,s)=>e.jsx(m,{className:"h-32"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((r,s)=>e.jsx(m,{className:"h-64"},s))})]})}export{te as DashboardPage};
