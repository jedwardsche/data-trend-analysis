import{j as e}from"./query-DCZjxv-P.js";import{C as S,a as y,b as C,d as T}from"./card-DYiaF_4c.js";import{c as G,T as A,a as v,b as O,d as P}from"./index-CxehogKC.js";import{f as w,a as b,b as p,r as Y}from"./formatters-Lk1sxCTq.js";import{R as _}from"./RetentionGauge-BnyyeZvn.js";import{R as M,P as $,a as B,C as W,T as I}from"./charts-DxkWeNkm.js";import{S as h}from"./skeleton-CNEFflKr.js";import{k as z}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const H=[["path",{d:"M5 12h14",key:"1ays0h"}]],K=G("minus",H);const U=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],q=G("trending-down",U);function m({title:r,value:n,previousValue:c,format:l="number",description:o,className:u}){const a=l==="percent"?w(n):l==="currency"?b(n):p(n),t=c!==void 0?(n-c)/c*100:null,s=t===null?null:t>0?A:t<0?q:K;return e.jsxs(S,{className:v("",u),children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:r}),s&&e.jsx(s,{className:v("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),t!==null&&e.jsxs("p",{className:v("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),o&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o})]})]})}const N=[{key:"returning",cssVar:"var(--chart-2)"},{key:"new",cssVar:"var(--chart-3)"}];function E({title:r,returningLabel:n,newLabel:c,returningValue:l,newValue:o,totalLabel:u}){const a=l+o,t=[{name:n,value:l,percent:a>0?l/a*100:0},{name:c,value:o,percent:a>0?o/a*100:0}];return e.jsxs(S,{children:[e.jsx(y,{children:e.jsx(C,{children:r})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px] h-[140px] flex-shrink-0",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs($,{children:[e.jsx(B,{data:t,cx:"50%",cy:"50%",innerRadius:38,outerRadius:62,paddingAngle:3,dataKey:"value",stroke:"none",children:t.map((s,d)=>e.jsx(W,{fill:N[d].cssVar},N[d].key))}),e.jsx(I,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"13px"},formatter:(s,d)=>[`${p(s)} (${w(t.find(i=>i.name===d)?.percent||0)})`,d]})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[t.map((s,d)=>e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-0.5 flex-shrink-0",style:{backgroundColor:N[d].cssVar}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:s.name}),e.jsxs("p",{className:"text-lg font-bold leading-tight",children:[p(s.value),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1.5",children:w(s.percent)})]})]})]},s.name)),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:u}),e.jsx("p",{className:"text-xl font-bold",children:p(a)})]})]})]})})]})}function le(){const{selectedYear:r}=z(),{data:n,isLoading:c,error:l}=O(r),{data:o}=P(r);if(c)return e.jsx(J,{});if(l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!n?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",r]})});const{snapshot:u,settings:a}=n,t=u.metrics,s=a.activeSchoolYears[a.activeSchoolYears.indexOf(r)-1],i=o?.snapshots?.[s]?.metrics,k=Object.values(u.byCampus||{}),V=k.filter(f=>f.returningStudents>0).length,D=k.filter(f=>f.returningStudents===0).length,x=a.fundingByYear?.[r],R=Y(x),F=R??0,g=R!=null,j=x!=null&&typeof x=="object"?x:null,L=(s?Y(a.fundingByYear?.[s]):void 0)??void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",r," • Last updated: ",new Date(u.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(m,{title:"Total Enrollment",value:t.totalEnrollment,previousValue:i?.totalEnrollment}),e.jsx(m,{title:"Returning Students",value:t.returningStudents,previousValue:i?.returningStudents}),e.jsx(m,{title:"New Students",value:t.totalNewGrowth,previousValue:i?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(m,{title:"Net Growth",value:t.netGrowth,previousValue:i?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(_,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:i?i.totalEnrollment-(i.verifiedTransfers||0):t.returningStudents}),e.jsx(E,{title:"Student Growth",returningLabel:"Returning Students",newLabel:"New Students",returningValue:t.returningStudents,newValue:t.totalNewGrowth,totalLabel:"Total Students"}),e.jsx(E,{title:"Campus Growth",returningLabel:"Returning Campuses",newLabel:"New Campuses",returningValue:V,newValue:D,totalLabel:"Total Campuses"}),e.jsxs(S,{children:[e.jsx(y,{children:e.jsxs(C,{children:["ERBOCES ",g?"Total":"Projected"," Revenue"]})}),e.jsxs(T,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:b(F)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:g&&j?`${j.students.toLocaleString()} students × $${j.perStudentCost.toLocaleString()}/student`:g?"Total funding":"No funding data — configure in Admin"}),L&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",b(L)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(m,{title:"Non-Starters",value:t.nonStarters,previousValue:i?.nonStarters,description:"Enrolled but never attended"}),e.jsx(m,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:i?.midYearWithdrawals,description:"Left after attending"}),e.jsx(m,{title:"Total Attrition",value:t.attritionTotal,previousValue:i?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function J(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{className:"h-9 w-64"}),e.jsx(h,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((r,n)=>e.jsx(h,{className:"h-32"},n))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((r,n)=>e.jsx(h,{className:"h-64"},n))})]})}export{le as DashboardPage};
