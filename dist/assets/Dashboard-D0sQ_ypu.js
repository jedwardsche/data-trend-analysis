import{j as e}from"./query-DCZjxv-P.js";import{C as b,a as y,b as C,d as T}from"./card-zxNv_rWH.js";import{c as G,T as M,a as v,b as $,d as B}from"./index-ozdxlcXu.js";import{f as w,a as S,b as g,r as E}from"./formatters-Lk1sxCTq.js";import{R as W}from"./RetentionGauge-kRgbx89s.js";import{R as I,P as z,a as H,C as K,T as U}from"./charts-DxkWeNkm.js";import{S as p}from"./skeleton-giR-cn4N.js";import{k as q}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const J=[["path",{d:"M5 12h14",key:"1ays0h"}]],Q=G("minus",J);const X=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Z=G("trending-down",X);function c({title:s,value:a,previousValue:u,format:i="number",description:o,className:m}){const n=i==="percent"?w(a):i==="currency"?S(a):g(a),t=u!==void 0?(a-u)/u*100:null,r=t===null?null:t>0?M:t<0?Z:Q;return e.jsxs(b,{className:v("",m),children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:s}),r&&e.jsx(r,{className:v("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n}),t!==null&&e.jsxs("p",{className:v("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),o&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:o})]})]})}const N=[{key:"returning",cssVar:"var(--chart-2)"},{key:"new",cssVar:"var(--chart-3)"}];function F({title:s,returningLabel:a,newLabel:u,returningValue:i,newValue:o,totalLabel:m}){const n=i+o,t=[{name:a,value:i,percent:n>0?i/n*100:0},{name:u,value:o,percent:n>0?o/n*100:0}];return e.jsxs(b,{children:[e.jsx(y,{children:e.jsx(C,{children:s})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px] h-[140px] flex-shrink-0",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(z,{children:[e.jsx(H,{data:t,cx:"50%",cy:"50%",innerRadius:38,outerRadius:62,paddingAngle:3,dataKey:"value",stroke:"none",children:t.map((r,d)=>e.jsx(K,{fill:N[d].cssVar},N[d].key))}),e.jsx(U,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"13px"},formatter:(r,d)=>[`${g(r)} (${w(t.find(l=>l.name===d)?.percent||0)})`,d]})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[t.map((r,d)=>e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-0.5 flex-shrink-0",style:{backgroundColor:N[d].cssVar}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:r.name}),e.jsxs("p",{className:"text-lg font-bold leading-tight",children:[g(r.value),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1.5",children:w(r.percent)})]})]})]},r.name)),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:m}),e.jsx("p",{className:"text-xl font-bold",children:g(n)})]})]})]})})]})}function ue(){const{selectedYear:s}=q(),{data:a,isLoading:u,error:i}=$(s),{data:o}=B(s);if(u)return e.jsx(ee,{});if(i)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!a?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",s]})});const{snapshot:m,settings:n}=a,t=m.metrics,r=n.activeSchoolYears[n.activeSchoolYears.indexOf(s)-1],l=o?.snapshots?.[r]?.metrics,k=Object.values(m.byCampus||{}),V=k.filter(f=>f.returningStudents>0).length,D=k.filter(f=>f.returningStudents===0).length,x=n.fundingByYear?.[s],L=E(x),A=L??0,j=L!=null,h=x!=null&&typeof x=="object"?x:null,R=(r?E(n.fundingByYear?.[r]):void 0)??void 0,O=[...n.activeSchoolYears].sort().pop(),P=s===O?"Current Enrollment":"Final Enrollment",Y=h?.students??null,_=n.nonStartersByYear?.[s]??t.nonStarters;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",s," • Last updated: ",new Date(m.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(c,{title:P,value:t.totalEnrollment,previousValue:l?.totalEnrollment}),e.jsx(c,{title:"Returning Students",value:t.returningStudents,previousValue:l?.returningStudents}),e.jsx(c,{title:"New Students",value:t.totalNewGrowth,previousValue:l?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(c,{title:"Net Growth",value:t.netGrowth,previousValue:l?.netGrowth,description:"New students minus withdrawals"}),Y!=null&&e.jsx(c,{title:"Total Funded",value:Y,description:"Funded students for this year"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(W,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:l?l.totalEnrollment-(l.verifiedTransfers||0):t.returningStudents}),e.jsx(F,{title:"Student Growth",returningLabel:"Returning Students",newLabel:"New Students",returningValue:t.returningStudents,newValue:t.totalNewGrowth,totalLabel:"Total Students"}),e.jsx(F,{title:"Campus Growth",returningLabel:"Returning Campuses",newLabel:"New Campuses",returningValue:V,newValue:D,totalLabel:"Total Campuses"}),e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(C,{children:["ERBOCES ",j?"Total":"Projected"," Revenue"]})}),e.jsxs(T,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:S(A)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:j&&h?`${h.students.toLocaleString()} students × $${h.perStudentCost.toLocaleString()}/student`:j?"Total funding":"No funding data — configure in Admin"}),R&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",S(R)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(c,{title:"Non-Starters",value:_,previousValue:l?.nonStarters,description:"Enrolled but never attended"}),e.jsx(c,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:l?.midYearWithdrawals,description:"Left after attending"}),e.jsx(c,{title:"Total Attrition",value:t.attritionTotal,previousValue:l?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function ee(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{className:"h-9 w-64"}),e.jsx(p,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((s,a)=>e.jsx(p,{className:"h-32"},a))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((s,a)=>e.jsx(p,{className:"h-64"},a))})]})}export{ue as DashboardPage};
