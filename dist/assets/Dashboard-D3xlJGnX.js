import{j as e}from"./query-PEscxNU0.js";import{C as f,a as v,b as N,d as w}from"./card-CFab1DRg.js";import{c as k,T as Y,a as h}from"./index-BREQ0THK.js";import{f as g,a as j,b as x,u as P,c as V,r as C}from"./useDashboardData-DutdldH1.js";import{R as D}from"./RetentionGauge-BpJZmr1j.js";import{R as G,P as A,a as L,C as _,T as F}from"./charts-DxkWeNkm.js";import{S as m}from"./skeleton-CUc6RUg3.js";import{k as M}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const $=[["path",{d:"M5 12h14",key:"1ays0h"}]],B=k("minus",$);const O=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],W=k("trending-down",O);function c({title:r,value:s,previousValue:l,format:d="number",description:a,className:n}){const i=d==="percent"?g(s):d==="currency"?j(s):x(s),t=l!==void 0?(s-l)/l*100:null,u=t===null?null:t>0?Y:t<0?W:B;return e.jsxs(f,{className:h("",n),children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:r}),u&&e.jsx(u,{className:h("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),t!==null&&e.jsxs("p",{className:h("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a})]})]})}const p=[{key:"returning",label:"Returning Campuses",cssVar:"var(--chart-2)"},{key:"new",label:"New Campuses",cssVar:"var(--chart-3)"}];function I({internalGrowth:r,newCampusGrowth:s}){const l=r+s,d=[{name:"Returning Campuses",value:r,percent:l>0?r/l*100:0},{name:"New Campuses",value:s,percent:l>0?s/l*100:0}];return e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(N,{children:"Growth Breakdown"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px] h-[140px] flex-shrink-0",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(L,{data:d,cx:"50%",cy:"50%",innerRadius:38,outerRadius:62,paddingAngle:3,dataKey:"value",stroke:"none",children:d.map((a,n)=>e.jsx(_,{fill:p[n].cssVar},p[n].key))}),e.jsx(F,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"13px"},formatter:(a,n)=>[`${x(a)} (${g(d.find(i=>i.name===n)?.percent||0)})`,n]})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[d.map((a,n)=>e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-0.5 flex-shrink-0",style:{backgroundColor:p[n].cssVar}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.name}),e.jsxs("p",{className:"text-lg font-bold leading-tight",children:[x(a.value),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1.5",children:g(a.percent)})]})]})]},a.name)),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total New Students"}),e.jsx("p",{className:"text-xl font-bold",children:x(l)})]})]})]})})]})}function se(){const{selectedYear:r}=M(),{data:s,isLoading:l,error:d}=P(r),{data:a}=V(r);if(l)return e.jsx(z,{});if(d)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!s?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",r]})});const{snapshot:n,settings:i}=s,t=n.metrics,u=i.activeSchoolYears[i.activeSchoolYears.indexOf(r)-1],o=a?.snapshots?.[u]?.metrics,b=C(i.fundingByYear?.[r]),R=i.erbocesPerStudentCost*t.totalEnrollment,T=b??R,S=b!=null,E=u?C(i.fundingByYear?.[u]):void 0,y=o?E??i.erbocesPerStudentCost*o.totalEnrollment:void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",r," • Last updated: ",new Date(n.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(c,{title:"Total Enrollment",value:t.totalEnrollment,previousValue:o?.totalEnrollment}),e.jsx(c,{title:"Returning Students",value:t.returningStudents,previousValue:o?.returningStudents}),e.jsx(c,{title:"New Students",value:t.totalNewGrowth,previousValue:o?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(c,{title:"Net Growth",value:t.netGrowth,previousValue:o?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(D,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:o?o.totalEnrollment-(o.verifiedTransfers||0):t.returningStudents}),e.jsx(I,{internalGrowth:t.internalGrowth,newCampusGrowth:t.newCampusGrowth}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(N,{children:["ERBOCES ",S?"Total":"Projected"," Revenue"]})}),e.jsxs(w,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:j(T)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:S?"Actual total funding":`${t.totalEnrollment.toLocaleString()} students × $${i.erbocesPerStudentCost.toLocaleString()}/student`}),y&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",j(y)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(c,{title:"Non-Starters",value:t.nonStarters,previousValue:o?.nonStarters,description:"Enrolled but never attended"}),e.jsx(c,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:o?.midYearWithdrawals,description:"Left after attending"}),e.jsx(c,{title:"Total Attrition",value:t.attritionTotal,previousValue:o?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function z(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{className:"h-9 w-64"}),e.jsx(m,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((r,s)=>e.jsx(m,{className:"h-32"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((r,s)=>e.jsx(m,{className:"h-64"},s))})]})}export{se as DashboardPage};
