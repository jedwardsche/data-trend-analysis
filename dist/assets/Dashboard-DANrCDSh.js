import{j as e}from"./query-PEscxNU0.js";import{C as w,a as b,b as y,d as S}from"./card-7_6ANI-v.js";import{c as R,T as E,a as j}from"./index-B29s0vHm.js";import{f as v,a as N,b as h,u as V,c as D,r as T}from"./useDashboardData-Cd9e7vjo.js";import{R as F}from"./RetentionGauge-BCfLpuzD.js";import{R as G,P as A,a as L,C as P,T as _}from"./charts-DxkWeNkm.js";import{S as x}from"./skeleton-DDvbVOj2.js";import{k as M}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const O=[["path",{d:"M5 12h14",key:"1ays0h"}]],$=R("minus",O);const B=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],W=R("trending-down",B);function c({title:r,value:s,previousValue:i,format:l="number",description:n,className:a}){const d=l==="percent"?v(s):l==="currency"?N(s):h(s),t=i!==void 0?(s-i)/i*100:null,u=t===null?null:t>0?E:t<0?W:$;return e.jsxs(w,{className:j("",a),children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:r}),u&&e.jsx(u,{className:j("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d}),t!==null&&e.jsxs("p",{className:j("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),n&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n})]})]})}const f=[{key:"returning",label:"Returning Campuses",cssVar:"var(--chart-2)"},{key:"new",label:"New Campuses",cssVar:"var(--chart-3)"}];function I({internalGrowth:r,newCampusGrowth:s}){const i=r+s,l=[{name:"Returning Campuses",value:r,percent:i>0?r/i*100:0},{name:"New Campuses",value:s,percent:i>0?s/i*100:0}];return e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(y,{children:"Growth Breakdown"})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px] h-[140px] flex-shrink-0",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(L,{data:l,cx:"50%",cy:"50%",innerRadius:38,outerRadius:62,paddingAngle:3,dataKey:"value",stroke:"none",children:l.map((n,a)=>e.jsx(P,{fill:f[a].cssVar},f[a].key))}),e.jsx(_,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"13px"},formatter:(n,a)=>[`${h(n)} (${v(l.find(d=>d.name===a)?.percent||0)})`,a]})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[l.map((n,a)=>e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-0.5 flex-shrink-0",style:{backgroundColor:f[a].cssVar}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:n.name}),e.jsxs("p",{className:"text-lg font-bold leading-tight",children:[h(n.value),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1.5",children:v(n.percent)})]})]})]},n.name)),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total New Students"}),e.jsx("p",{className:"text-xl font-bold",children:h(i)})]})]})]})})]})}function re(){const{selectedYear:r}=M(),{data:s,isLoading:i,error:l}=V(r),{data:n}=D(r);if(i)return e.jsx(z,{});if(l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!s?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",r]})});const{snapshot:a,settings:d}=s,t=a.metrics,u=d.activeSchoolYears[d.activeSchoolYears.indexOf(r)-1],o=n?.snapshots?.[u]?.metrics,m=d.fundingByYear?.[r],C=T(m),Y=C??0,p=C!=null,g=m!=null&&typeof m=="object"?m:null,k=(u?T(d.fundingByYear?.[u]):void 0)??void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",r," • Last updated: ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(c,{title:"Total Enrollment",value:t.totalEnrollment,previousValue:o?.totalEnrollment}),e.jsx(c,{title:"Returning Students",value:t.returningStudents,previousValue:o?.returningStudents}),e.jsx(c,{title:"New Students",value:t.totalNewGrowth,previousValue:o?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(c,{title:"Net Growth",value:t.netGrowth,previousValue:o?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(F,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:o?o.totalEnrollment-(o.verifiedTransfers||0):t.returningStudents}),e.jsx(I,{internalGrowth:t.internalGrowth,newCampusGrowth:t.newCampusGrowth}),e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs(y,{children:["ERBOCES ",p?"Total":"Projected"," Revenue"]})}),e.jsxs(S,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:N(Y)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:p&&g?`${g.students.toLocaleString()} students × $${g.perStudentCost.toLocaleString()}/student`:p?"Total funding":"No funding data — configure in Admin"}),k&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",N(k)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(c,{title:"Non-Starters",value:t.nonStarters,previousValue:o?.nonStarters,description:"Enrolled but never attended"}),e.jsx(c,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:o?.midYearWithdrawals,description:"Left after attending"}),e.jsx(c,{title:"Total Attrition",value:t.attritionTotal,previousValue:o?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function z(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(x,{className:"h-9 w-64"}),e.jsx(x,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((r,s)=>e.jsx(x,{className:"h-32"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((r,s)=>e.jsx(x,{className:"h-64"},s))})]})}export{re as DashboardPage};
