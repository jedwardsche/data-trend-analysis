import{j as e}from"./query-PEscxNU0.js";import{C as j,a as g,b as v,d as f}from"./card-BVP9ISh_.js";import{c as w,T as y,a as x}from"./index-BjTlyl9m.js";import{f as S,a as h,b as p,u as C,c as R,S as m}from"./skeleton-D3kqVnK9.js";import{R as T}from"./RetentionGauge-DWF9P4Ig.js";import{R as E,P as L,a as k,C as P,T as Y,L as D}from"./charts-BfQSYQe1.js";import{k as G}from"./vendor-rrO37E5y.js";import"./firebase-CBGyZlqu.js";import"./functions-BHy5G0pi.js";const O=[["path",{d:"M5 12h14",key:"1ays0h"}]],A=w("minus",O);const V=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],_=w("trending-down",V);function c({title:r,value:s,previousValue:o,format:l="number",description:d,className:i}){const a=l==="percent"?S(s):l==="currency"?h(s):p(s),t=o!==void 0?(s-o)/o*100:null,u=t===null?null:t>0?y:t<0?_:A;return e.jsxs(j,{className:x("",i),children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:r}),u&&e.jsx(u,{className:x("h-4 w-4",t!==null&&t>0&&"text-green-500",t!==null&&t<0&&"text-red-500",t===0&&"text-muted-foreground")})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),t!==null&&e.jsxs("p",{className:x("text-xs",t>0&&"text-green-500",t<0&&"text-red-500",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),d&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:d})]})]})}function M({internalGrowth:r,newCampusGrowth:s}){const o=r+s,l=[{name:"Returning Campuses",value:r,percent:o>0?r/o*100:0},{name:"New Campuses",value:s,percent:o>0?s/o*100:0}],d=["hsl(var(--chart-2))","hsl(var(--chart-3))"];return e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(v,{children:"Growth Breakdown"})}),e.jsxs(f,{children:[e.jsx("div",{className:"h-[250px]",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(L,{children:[e.jsx(k,{data:l,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:l.map((i,a)=>e.jsx(P,{fill:d[a%d.length]},i.name))}),e.jsx(Y,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(i,a)=>[`${p(i)} (${S(l.find(t=>t.name===a)?.percent||0)})`,a]}),e.jsx(D,{})]})})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:p(o)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total New Students"})]})]})]})}function Q(){const{selectedYear:r}=G(),{data:s,isLoading:o,error:l}=C(r),{data:d}=R(r);if(o)return e.jsx($,{});if(l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!s?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",r]})});const{snapshot:i,settings:a}=s,t=i.metrics,u=a.activeSchoolYears[a.activeSchoolYears.indexOf(r)-1],n=d?.snapshots?.[u]?.metrics,b=a.erbocesPerStudentCost*t.totalEnrollment,N=n?a.erbocesPerStudentCost*n.totalEnrollment:void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",r," • Last updated: ",new Date(i.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(c,{title:"Total Enrollment",value:t.totalEnrollment,previousValue:n?.totalEnrollment}),e.jsx(c,{title:"Returning Students",value:t.returningStudents,previousValue:n?.returningStudents}),e.jsx(c,{title:"New Students",value:t.totalNewGrowth,previousValue:n?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(c,{title:"Net Growth",value:t.netGrowth,previousValue:n?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(T,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:n?n.totalEnrollment-(n.verifiedTransfers||0):t.returningStudents}),e.jsx(M,{internalGrowth:t.internalGrowth,newCampusGrowth:t.newCampusGrowth}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(v,{children:"ERBOCES Projected Revenue"})}),e.jsxs(f,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-green-600",children:h(b)}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[t.totalEnrollment.toLocaleString()," students × $",a.erbocesPerStudentCost.toLocaleString(),"/student"]}),N&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",h(N)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(c,{title:"Non-Starters",value:t.nonStarters,previousValue:n?.nonStarters,description:"Enrolled but never attended"}),e.jsx(c,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:n?.midYearWithdrawals,description:"Left after attending"}),e.jsx(c,{title:"Total Attrition",value:t.attritionTotal,previousValue:n?.attritionTotal,description:"Non-starters + withdrawals"})]})]})}function $(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{className:"h-9 w-64"}),e.jsx(m,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((r,s)=>e.jsx(m,{className:"h-32"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((r,s)=>e.jsx(m,{className:"h-64"},s))})]})}export{Q as DashboardPage};
