import{j as e}from"./query-DCZjxv-P.js";import{C as j,a as f,b as v,d as N}from"./card-Cn5l_r2m.js";import{c as A,T as M,a as S,b as B,d as W}from"./index-BLNj4MAc.js";import{f as C,a as E,b as g,r as F}from"./formatters-Lk1sxCTq.js";import{R as I}from"./RetentionGauge-DM20_0Lh.js";import{R as z,P as H,a as K,C as U,T as q}from"./charts-DxkWeNkm.js";import{S as p}from"./skeleton-DuCt1toF.js";import{k as J}from"./vendor-rrO37E5y.js";import"./firebase-Cbh-IGzk.js";const Q=[["path",{d:"M5 12h14",key:"1ays0h"}]],X=A("minus",Q);const Z=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ee=A("trending-down",Z);function m({title:n,value:l,previousValue:c,format:o="number",description:i,className:u}){const r=o==="percent"?C(l):o==="currency"?E(l):g(l),t=c!==void 0?(l-c)/c*100:null,a=t===null?null:t>0?M:t<0?ee:X;return e.jsxs(j,{className:S("",u),children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:n}),a&&e.jsx(a,{className:S("h-4 w-4",t!==null&&t>0&&"text-success",t!==null&&t<0&&"text-destructive",t===0&&"text-muted-foreground")})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),t!==null&&e.jsxs("p",{className:S("text-xs",t>0&&"text-success",t<0&&"text-destructive",t===0&&"text-muted-foreground"),children:[t>0?"+":"",t.toFixed(1),"% from previous year"]}),i&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]})]})}const y=[{key:"returning",cssVar:"var(--chart-2)"},{key:"new",cssVar:"var(--chart-3)"}];function G({title:n,returningLabel:l,newLabel:c,returningValue:o,newValue:i,totalLabel:u}){const r=o+i,t=[{name:l,value:o,percent:r>0?o/r*100:0},{name:c,value:i,percent:r>0?i/r*100:0}];return e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(v,{children:n})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px] h-[140px] flex-shrink-0",children:e.jsx(z,{width:"100%",height:"100%",children:e.jsxs(H,{children:[e.jsx(K,{data:t,cx:"50%",cy:"50%",innerRadius:38,outerRadius:62,paddingAngle:3,dataKey:"value",stroke:"none",children:t.map((a,d)=>e.jsx(U,{fill:y[d].cssVar},y[d].key))}),e.jsx(q,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px",fontSize:"13px"},formatter:(a,d)=>[`${g(a)} (${C(t.find(s=>s.name===d)?.percent||0)})`,d]})]})})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[t.map((a,d)=>e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mt-0.5 flex-shrink-0",style:{backgroundColor:y[d].cssVar}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.name}),e.jsxs("p",{className:"text-lg font-bold leading-tight",children:[g(a.value),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1.5",children:C(a.percent)})]})]})]},a.name)),e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:u}),e.jsx("p",{className:"text-xl font-bold",children:g(r)})]})]})]})})]})}function me(){const{selectedYear:n}=J(),{data:l,isLoading:c,error:o}=B(n),{data:i}=W(n);if(c)return e.jsx(te,{});if(o)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-destructive",children:"Failed to load dashboard data"})});if(!l?.snapshot)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No data available for ",n]})});const{snapshot:u,settings:r}=l,t=u.metrics,a=r.activeSchoolYears[r.activeSchoolYears.indexOf(n)-1],s=i?.snapshots?.[a]?.metrics,L=Object.values(u.byCampus||{}),D=L.filter(b=>b.returningStudents>0).length,V=L.filter(b=>b.returningStudents===0).length,x=r.fundingByYear?.[n],Y=F(x),O=Y??0,w=Y!=null,h=x!=null&&typeof x=="object"?x:null,k=(a?F(r.fundingByYear?.[a]):void 0)??void 0,P=[...r.activeSchoolYears].sort().pop(),_=n===P?"Current Enrollment":"Final Enrollment",R=h?.students??null,T=r.nonStartersByYear?.[n]??t.nonStarters,$=T+t.midYearWithdrawals;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("p",{className:"text-muted-foreground",children:["School Year ",n," • Last updated: ",new Date(u.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:_})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalEnrollment.toLocaleString()}),s?.totalEnrollment!==void 0&&e.jsxs("p",{className:`text-xs ${t.totalEnrollment>s.totalEnrollment?"text-success":t.totalEnrollment<s.totalEnrollment?"text-destructive":"text-muted-foreground"}`,children:[t.totalEnrollment>s.totalEnrollment?"+":"",((t.totalEnrollment-s.totalEnrollment)/s.totalEnrollment*100).toFixed(1),"% from previous year"]}),R!=null&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Funded"}),e.jsx("p",{className:"text-lg font-semibold",children:R.toLocaleString()})]})]})]}),e.jsx(m,{title:"Returning Students",value:t.returningStudents,previousValue:s?.returningStudents}),e.jsx(m,{title:"New Students",value:t.totalNewGrowth,previousValue:s?.totalNewGrowth,description:"At returning + new campuses"}),e.jsx(m,{title:"Net Growth",value:t.netGrowth,previousValue:s?.netGrowth,description:"New students minus withdrawals"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(I,{rate:t.retentionRate,returningStudents:t.returningStudents,eligibleStudents:s?s.totalEnrollment-(s.verifiedTransfers||0):t.returningStudents}),e.jsx(G,{title:"Student Growth",returningLabel:"Returning Students",newLabel:"New Students",returningValue:t.returningStudents,newValue:t.totalNewGrowth,totalLabel:"Total Students"}),e.jsx(G,{title:"Campus Growth",returningLabel:"Returning Campuses",newLabel:"New Campuses",returningValue:D,newValue:V,totalLabel:"Total Campuses"}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsxs(v,{children:["ERBOCES ",w?"Total":"Projected"," Revenue"]})}),e.jsxs(N,{className:"flex flex-col items-center justify-center h-[200px]",children:[e.jsx("p",{className:"text-4xl font-bold text-success",children:E(O)}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:w&&h?`${h.students.toLocaleString()} students × $${h.perStudentCost.toLocaleString()}/student`:w?"Total funding":"No funding data — configure in Admin"}),k&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Previous year: ",E(k)]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(m,{title:"Non-Starters",value:T,previousValue:s?.nonStarters,description:"Enrolled but never attended"}),e.jsx(m,{title:"Mid-Year Withdrawals",value:t.midYearWithdrawals,previousValue:s?.midYearWithdrawals,description:"Left after attending"}),e.jsx(m,{title:"Total Attrition",value:$,previousValue:s?s.nonStarters+s.midYearWithdrawals:void 0,description:"Non-starters + withdrawals"})]})]})}function te(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{className:"h-9 w-64"}),e.jsx(p,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((n,l)=>e.jsx(p,{className:"h-32"},l))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((n,l)=>e.jsx(p,{className:"h-64"},l))})]})}export{me as DashboardPage};
