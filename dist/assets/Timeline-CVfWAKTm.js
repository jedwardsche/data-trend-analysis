import{j as e}from"./query-DCZjxv-P.js";import{r as f,k as H}from"./vendor-rrO37E5y.js";import{s as X,i as q,P as y,j as J,R as Q,I as U,k as E,t as z,o as Z,l as ee,f as S,v as te,C as g,a as b,b as p,d as j,w as ae,g as re}from"./index-CRNysr_W.js";import{S as w}from"./skeleton-BJdrlhLC.js";import{d as se,b as x,e as A}from"./formatters-Lk1sxCTq.js";import{R as ne,A as ie,b as D,X as I,Y as _,T as F,d as oe,L as le,e as de}from"./charts-DxkWeNkm.js";import{T as ce,a as ue,b as P,c as N,d as me,e as T}from"./table-CgmVuTBs.js";import"./firebase-Cbh-IGzk.js";var C="Tabs",[xe]=Z(C,[z]),V=z(),[he,R]=xe(C),M=f.forwardRef((t,r)=>{const{__scopeTabs:n,value:a,onValueChange:o,defaultValue:c,orientation:i="horizontal",dir:u,activationMode:h="automatic",...v}=t,s=X(u),[l,m]=q({prop:a,onChange:o,defaultProp:c??"",caller:C});return e.jsx(he,{scope:n,baseId:J(),value:l,onValueChange:m,orientation:i,dir:s,activationMode:h,children:e.jsx(y.div,{dir:s,"data-orientation":i,...v,ref:r})})});M.displayName=C;var W="TabsList",$=f.forwardRef((t,r)=>{const{__scopeTabs:n,loop:a=!0,...o}=t,c=R(W,n),i=V(n);return e.jsx(Q,{asChild:!0,...i,orientation:c.orientation,dir:c.dir,loop:a,children:e.jsx(y.div,{role:"tablist","aria-orientation":c.orientation,...o,ref:r})})});$.displayName=W;var G="TabsTrigger",K=f.forwardRef((t,r)=>{const{__scopeTabs:n,value:a,disabled:o=!1,...c}=t,i=R(G,n),u=V(n),h=O(i.baseId,a),v=B(i.baseId,a),s=a===i.value;return e.jsx(U,{asChild:!0,...u,focusable:!o,active:s,children:e.jsx(y.button,{type:"button",role:"tab","aria-selected":s,"aria-controls":v,"data-state":s?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:h,...c,ref:r,onMouseDown:E(t.onMouseDown,l=>{!o&&l.button===0&&l.ctrlKey===!1?i.onValueChange(a):l.preventDefault()}),onKeyDown:E(t.onKeyDown,l=>{[" ","Enter"].includes(l.key)&&i.onValueChange(a)}),onFocus:E(t.onFocus,()=>{const l=i.activationMode!=="manual";!s&&!o&&l&&i.onValueChange(a)})})})});K.displayName=G;var Y="TabsContent",ve=f.forwardRef((t,r)=>{const{__scopeTabs:n,value:a,forceMount:o,children:c,...i}=t,u=R(Y,n),h=O(u.baseId,a),v=B(u.baseId,a),s=a===u.value,l=f.useRef(s);return f.useEffect(()=>{const m=requestAnimationFrame(()=>l.current=!1);return()=>cancelAnimationFrame(m)},[]),e.jsx(ee,{present:o||s,children:({present:m})=>e.jsx(y.div,{"data-state":s?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":h,hidden:!m,id:v,tabIndex:0,...i,ref:r,style:{...t.style,animationDuration:l.current?"0s":void 0},children:m&&c})})});ve.displayName=Y;function O(t,r){return`${t}-trigger-${r}`}function B(t,r){return`${t}-content-${r}`}var fe=M,ge=$,be=K;function pe({className:t,orientation:r="horizontal",...n}){return e.jsx(fe,{"data-slot":"tabs","data-orientation":r,orientation:r,className:S("group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",t),...n})}const je=te("rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",{variants:{variant:{default:"bg-muted",line:"gap-1 bg-transparent"}},defaultVariants:{variant:"default"}});function Ne({className:t,variant:r="default",...n}){return e.jsx(ge,{"data-slot":"tabs-list","data-variant":r,className:S(je({variant:r}),t),...n})}function L({className:t,...r}){return e.jsx(be,{"data-slot":"tabs-trigger",className:S("focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent","data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground","after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",t),...r})}function Te({timeline:t,showCumulative:r=!0}){const n=t.map(a=>({week:`W${a.weekNumber}`,date:se(a.weekStart),new:a.newEnrollments,cumulative:a.cumulativeEnrollment}));return e.jsxs(g,{children:[e.jsx(b,{children:e.jsx(p,{children:"Enrollment Timeline"})}),e.jsx(j,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(ne,{width:"100%",height:"100%",children:r?e.jsxs(ie,{data:n,children:[e.jsx(D,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(I,{dataKey:"date",tick:{fill:"var(--muted-foreground)",fontSize:12}}),e.jsx(_,{tick:{fill:"var(--muted-foreground)"},tickFormatter:a=>x(a)}),e.jsx(F,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px"},formatter:(a,o)=>[x(a),o==="cumulative"?"Total Enrolled":"New This Week"]}),e.jsx(oe,{type:"monotone",dataKey:"cumulative",stroke:"var(--chart-1)",fill:"var(--chart-1)",fillOpacity:.2})]}):e.jsxs(le,{data:n,children:[e.jsx(D,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(I,{dataKey:"date",tick:{fill:"var(--muted-foreground)",fontSize:12}}),e.jsx(_,{tick:{fill:"var(--muted-foreground)"},tickFormatter:a=>x(a)}),e.jsx(F,{contentStyle:{backgroundColor:"var(--background)",border:"1px solid var(--border)",borderRadius:"8px"},formatter:a=>[x(a),"New Enrollments"]}),e.jsx(de,{type:"monotone",dataKey:"new",stroke:"var(--chart-2)",strokeWidth:2,dot:{fill:"var(--chart-2)"}})]})})})})]})}function Ie(){const{selectedYear:t}=H(),{data:r,isLoading:n,error:a}=ae(t),{data:o}=re(t),[c,i]=f.useState("cumulative"),u=o?.settings?.activeSchoolYears,h=u?[...u].sort().pop():void 0,v=t===h?"Current Enrollment":"Final Enrollment";if(n)return e.jsx(ke,{});if(a||!r?.timeline||r.timeline.length===0)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("p",{className:"text-muted-foreground",children:["No timeline data available for ",t]})});const{timeline:s}=r,l=s.reduce((d,k)=>k.newEnrollments>d.newEnrollments?k:d),m=s.reduce((d,k)=>d+k.newEnrollments,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Enrollment Timeline"}),e.jsxs("p",{className:"text-muted-foreground",children:["Track when students enrolled throughout ",t]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(g,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:v})}),e.jsx(j,{children:e.jsx("p",{className:"text-2xl font-bold",children:x(s[s.length-1]?.cumulativeEnrollment||0)})})]}),e.jsxs(g,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Peak Week"})}),e.jsxs(j,{children:[e.jsxs("p",{className:"text-2xl font-bold",children:["Week ",l.weekNumber]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x(l.newEnrollments)," new enrollments"]})]})]}),e.jsxs(g,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Date Range"})}),e.jsxs(j,{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[s.length," weeks"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[A(s[0].weekStart)," â€“ ",A(s[s.length-1].weekStart)]})]})]})]}),e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Enrollment Over Time"}),e.jsx(pe,{value:c,onValueChange:d=>i(d),children:e.jsxs(Ne,{children:[e.jsx(L,{value:"cumulative",children:"Cumulative"}),e.jsx(L,{value:"weekly",children:"Weekly"})]})})]})}),e.jsx(j,{children:e.jsx(Te,{timeline:s,showCumulative:c==="cumulative"})})]}),e.jsxs(g,{children:[e.jsx(b,{children:e.jsx(p,{children:"Weekly Breakdown"})}),e.jsx(j,{children:e.jsxs(ce,{children:[e.jsx(ue,{children:e.jsxs(P,{children:[e.jsx(N,{children:"Week"}),e.jsx(N,{children:"Start Date"}),e.jsx(N,{className:"text-right",children:"New Enrollments"}),e.jsx(N,{className:"text-right",children:"Cumulative Total"}),e.jsx(N,{className:"text-right",children:"% of Total"})]})}),e.jsx(me,{children:s.map(d=>e.jsxs(P,{children:[e.jsxs(T,{className:"font-medium",children:["Week ",d.weekNumber]}),e.jsx(T,{children:new Date(d.weekStart).toLocaleDateString()}),e.jsx(T,{className:"text-right",children:x(d.newEnrollments)}),e.jsx(T,{className:"text-right",children:x(d.cumulativeEnrollment)}),e.jsxs(T,{className:"text-right",children:[m>0?(d.newEnrollments/m*100).toFixed(1):0,"%"]})]},d.id))})]})})]})]})}function ke(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(w,{className:"h-9 w-64"}),e.jsx(w,{className:"h-5 w-48 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[...Array(3)].map((t,r)=>e.jsx(w,{className:"h-24"},r))}),e.jsx(w,{className:"h-[400px]"})]})}export{Ie as TimelinePage};
