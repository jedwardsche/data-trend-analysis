import{j as e}from"./query-PEscxNU0.js";import{C as f,a as g,b as N,d as b}from"./card-DFrA6KgX.js";import{T as G,a as T,b as C,c as v,d as R,e as w}from"./table-DnmNn9sZ.js";import{c as S,b as p,f as Y,S as x,d as V}from"./skeleton-CHJA7Efb.js";import{B as E}from"./badge-C-_tHALX.js";import{k as P}from"./vendor-rrO37E5y.js";import"./index-D5AKj6n6.js";import"./firebase-CBGyZlqu.js";import"./charts-mYDaWYVf.js";import"./functions-CZAEqjTx.js";function L(){const{selectedYear:h}=P(),{data:o,isLoading:d,error:u}=S(h);if(d)return e.jsx(k,{});if(u||!o?.snapshots)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No historical data available"})});const{snapshots:r,settings:c}=o,s=c.activeSchoolYears.filter(t=>r[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Year-Over-Year Comparison"}),e.jsx("p",{className:"text-muted-foreground",children:"Compare key metrics across school years"})]}),e.jsx("iframe",{src:"https://enroll.che.school/embed/cumulative-enrollment",className:"w-full border-0",style:{height:"55vh"},title:"Cumulative Enrollment"}),e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{children:"Key Metrics Comparison"})}),e.jsx(b,{children:e.jsxs(G,{children:[e.jsx(T,{children:e.jsxs(C,{children:[e.jsx(v,{children:"Metric"}),s.map(t=>e.jsxs(v,{className:"text-right",children:[t,t===c.currentSchoolYear&&e.jsx(E,{variant:"outline",className:"ml-2",children:"Current"})]},t))]})}),e.jsxs(R,{children:[e.jsx(a,{label:"Total Enrollment",years:s,getValue:t=>r[t].metrics.totalEnrollment,format:"number"}),e.jsx(a,{label:"Returning Students",years:s,getValue:t=>r[t].metrics.returningStudents,format:"number"}),e.jsx(a,{label:"Retention Rate",years:s,getValue:t=>r[t].metrics.retentionRate,format:"percent"}),e.jsx(a,{label:"Internal Growth",years:s,getValue:t=>r[t].metrics.internalGrowth,format:"number"}),e.jsx(a,{label:"New Campus Growth",years:s,getValue:t=>r[t].metrics.newCampusGrowth,format:"number"}),e.jsx(a,{label:"Total New Students",years:s,getValue:t=>r[t].metrics.totalNewGrowth,format:"number"}),e.jsx(a,{label:"Non-Starters",years:s,getValue:t=>r[t].metrics.nonStarters,format:"number",invertColor:!0}),e.jsx(a,{label:"Mid-Year Withdrawals",years:s,getValue:t=>r[t].metrics.midYearWithdrawals,format:"number",invertColor:!0}),e.jsx(a,{label:"Net Growth",years:s,getValue:t=>r[t].metrics.netGrowth,format:"number"})]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.slice(1).map((t,l)=>{const i=r[t].metrics,m=r[s[l]].metrics,n=i.totalEnrollment-m.totalEnrollment,j=(n/m.totalEnrollment*100).toFixed(1);return e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(N,{className:"text-lg",children:[s[l]," â†’ ",t]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enrollment Growth"}),e.jsxs("p",{className:"text-2xl font-bold",children:[n>0?"+":"",p(n),e.jsxs("span",{className:"text-lg ml-2 text-muted-foreground",children:["(",j,"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention Rate"}),e.jsx("p",{className:"font-medium",children:Y(i.retentionRate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Net Growth"}),e.jsx("p",{className:"font-medium",children:p(i.netGrowth)})]})]})]})]},t)})})]})}function a({label:h,years:o,getValue:d,format:u,invertColor:r=!1}){return e.jsxs(C,{children:[e.jsx(w,{className:"font-medium",children:h}),o.map((c,s)=>{const t=d(c),l=s>0?d(o[s-1]):null,i=u==="percent"?Y(t):p(t),m=l!==null?V(t,l):null,n=l!==null&&t>l,j=r?n?"text-destructive":"text-success":n?"text-success":"text-destructive";return e.jsxs(w,{className:"text-right",children:[e.jsx("span",{children:i}),m&&e.jsx("span",{className:`text-xs ml-2 ${j}`,children:m})]},c)})]})}function k(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(x,{className:"h-9 w-64"}),e.jsx(x,{className:"h-5 w-48 mt-2"})]}),e.jsx(x,{className:"h-[350px]"}),e.jsx(x,{className:"h-96"})]})}export{L as YearOverYearPage};
