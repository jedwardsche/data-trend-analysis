import{j as e}from"./query-PEscxNU0.js";import{k as K,r as R}from"./vendor-rrO37E5y.js";import{C as p,a as f,b as g,d as b}from"./card-CvKyquMr.js";import{T as M,a as k,b as E,c as y,d as B,e as T}from"./table-B2I4_9IN.js";import{S as m}from"./skeleton-NRffPWfo.js";import{c as P,d as A,b as w,f as G,e as O}from"./useDashboardData--dUiMfac.js";import{B as D}from"./badge-CDLwJsqM.js";import{C as Y}from"./CampusCumulativeChart-x7P42WuN.js";import{a as S}from"./campus-utils-CCZNi6hh.js";import"./index-Rivh-WXP.js";import"./firebase-Cbh-IGzk.js";import"./charts-DxkWeNkm.js";function _(){const{selectedYear:N}=K(),{data:l,isLoading:x,error:v}=P(N),{data:d,isLoading:u}=A(),{branchKeys:h,microKeys:n}=R.useMemo(()=>{if(!l?.snapshots)return{branchKeys:[],microKeys:[]};const s=new Set,o=new Set;for(const i of Object.values(l.snapshots)){for(const c of S(i.byCampus,"branch"))s.add(c);for(const c of S(i.byCampus,"micro-campus"))o.add(c)}return{branchKeys:Array.from(s),microKeys:Array.from(o)}},[l?.snapshots]);if(x)return e.jsx(H,{});if(v||!l?.snapshots)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No historical data available"})});const{snapshots:t,settings:j}=l,r=j.activeSchoolYears.filter(s=>t[s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Year-Over-Year Comparison"}),e.jsx("p",{className:"text-muted-foreground",children:"Compare key metrics across school years"})]}),e.jsx("iframe",{src:"https://enroll.che.school/embed/cumulative-enrollment",className:"w-full border-0",style:{height:"55vh"},title:"Cumulative Enrollment"}),d?.timelines&&e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[h.length>0&&e.jsxs(p,{children:[e.jsx(f,{children:e.jsx(g,{children:"Branch Campus Enrollment"})}),e.jsx(b,{children:e.jsx(Y,{timelines:d.timelines,campusKeys:h})})]}),n.length>0&&e.jsxs(p,{children:[e.jsx(f,{children:e.jsx(g,{children:"Micro-Campus Enrollment"})}),e.jsx(b,{children:e.jsx(Y,{timelines:d.timelines,campusKeys:n})})]})]}),u&&e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(m,{className:"h-[400px]"}),e.jsx(m,{className:"h-[400px]"})]}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsx(g,{children:"Key Metrics Comparison"})}),e.jsx(b,{children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsxs(E,{children:[e.jsx(y,{children:"Metric"}),r.map(s=>e.jsxs(y,{className:"text-right",children:[s,s===j.currentSchoolYear&&e.jsx(D,{variant:"outline",className:"ml-2",children:"Current"})]},s))]})}),e.jsxs(B,{children:[e.jsx(a,{label:"Total Enrollment",years:r,getValue:s=>t[s].metrics.totalEnrollment,format:"number"}),e.jsx(a,{label:"Returning Students",years:r,getValue:s=>t[s].metrics.returningStudents,format:"number"}),e.jsx(a,{label:"Retention Rate",years:r,getValue:s=>t[s].metrics.retentionRate,format:"percent"}),e.jsx(a,{label:"Internal Growth",years:r,getValue:s=>t[s].metrics.internalGrowth,format:"number"}),e.jsx(a,{label:"New Campus Growth",years:r,getValue:s=>t[s].metrics.newCampusGrowth,format:"number"}),e.jsx(a,{label:"Total New Students",years:r,getValue:s=>t[s].metrics.totalNewGrowth,format:"number"}),e.jsx(a,{label:"Non-Starters",years:r,getValue:s=>t[s].metrics.nonStarters,format:"number",invertColor:!0}),e.jsx(a,{label:"Mid-Year Withdrawals",years:r,getValue:s=>t[s].metrics.midYearWithdrawals,format:"number",invertColor:!0}),e.jsx(a,{label:"Total Attrition",years:r,getValue:s=>t[s].metrics.attritionTotal,format:"number",invertColor:!0}),e.jsx(a,{label:"Net Growth",years:r,getValue:s=>t[s].metrics.netGrowth,format:"number"})]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:r.slice(1).map((s,o)=>{const i=t[s].metrics,c=t[r[o]].metrics,C=i.totalEnrollment-c.totalEnrollment,V=(C/c.totalEnrollment*100).toFixed(1);return e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(g,{className:"text-lg",children:[r[o]," â†’ ",s]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enrollment Growth"}),e.jsxs("p",{className:"text-2xl font-bold",children:[C>0?"+":"",w(C),e.jsxs("span",{className:"text-lg ml-2 text-muted-foreground",children:["(",V,"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention Rate"}),e.jsx("p",{className:"font-medium",children:G(i.retentionRate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Net Growth"}),e.jsx("p",{className:"font-medium",children:w(i.netGrowth)})]})]})]})]},s)})})]})}function a({label:N,years:l,getValue:x,format:v,invertColor:d=!1}){return e.jsxs(E,{children:[e.jsx(T,{className:"font-medium",children:N}),l.map((u,h)=>{const n=x(u),t=h>0?x(l[h-1]):null,j=v==="percent"?G(n):w(n),r=t!==null?O(n,t):null,s=t!==null&&n>t,o=d?s?"text-destructive":"text-success":s?"text-success":"text-destructive";return e.jsxs(T,{className:"text-right",children:[e.jsx("span",{children:j}),r&&e.jsx("span",{className:`text-xs ml-2 ${o}`,children:r})]},u)})]})}function H(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{className:"h-9 w-64"}),e.jsx(m,{className:"h-5 w-48 mt-2"})]}),e.jsx(m,{className:"h-[350px]"}),e.jsx(m,{className:"h-96"})]})}export{_ as YearOverYearPage};
