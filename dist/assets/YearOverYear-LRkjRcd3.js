import{j as e}from"./query-PEscxNU0.js";import{C as g,a as N,b,d as w}from"./card-BVP9ISh_.js";import{T as k,a as G,b as Y,c as v,d as y,e as C}from"./table-BpeqsKHD.js";import{b as u,c as S,f as R,S as j,d as T}from"./skeleton-D3kqVnK9.js";import{R as E,B as V,b as B,X as I,Y as K,T as P,L as M,d as f}from"./charts-BfQSYQe1.js";import{B as O}from"./badge-CpW3Mgi5.js";import{k as H}from"./vendor-rrO37E5y.js";import"./index-BjTlyl9m.js";import"./firebase-CBGyZlqu.js";import"./functions-BHy5G0pi.js";function L({snapshots:m,title:l="Enrollment by Year"}){const i=Object.entries(m).map(([a,r])=>({year:a,total:r.metrics.totalEnrollment,returning:r.metrics.returningStudents,newInternal:r.metrics.internalGrowth,newCampus:r.metrics.newCampusGrowth})).sort((a,r)=>a.year.localeCompare(r.year));return e.jsxs(g,{children:[e.jsx(N,{children:e.jsx(b,{children:l})}),e.jsx(w,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(V,{data:i,children:[e.jsx(B,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(I,{dataKey:"year",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(K,{tick:{fill:"hsl(var(--muted-foreground))"},tickFormatter:a=>u(a)}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:a=>u(a)}),e.jsx(M,{}),e.jsx(f,{dataKey:"returning",name:"Returning Students",stackId:"a",fill:"hsl(var(--chart-1))"}),e.jsx(f,{dataKey:"newInternal",name:"New (Returning Campuses)",stackId:"a",fill:"hsl(var(--chart-2))"}),e.jsx(f,{dataKey:"newCampus",name:"New (New Campuses)",stackId:"a",fill:"hsl(var(--chart-3))"})]})})})})]})}function Z(){const{selectedYear:m}=H(),{data:l,isLoading:i,error:a}=S(m);if(i)return e.jsx(A,{});if(a||!l?.snapshots)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No historical data available"})});const{snapshots:r,settings:d}=l,s=d.activeSchoolYears.filter(t=>r[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Year-Over-Year Comparison"}),e.jsx("p",{className:"text-muted-foreground",children:"Compare key metrics across school years"})]}),e.jsx(L,{snapshots:r}),e.jsxs(g,{children:[e.jsx(N,{children:e.jsx(b,{children:"Key Metrics Comparison"})}),e.jsx(w,{children:e.jsxs(k,{children:[e.jsx(G,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"Metric"}),s.map(t=>e.jsxs(v,{className:"text-right",children:[t,t===d.currentSchoolYear&&e.jsx(O,{variant:"outline",className:"ml-2",children:"Current"})]},t))]})}),e.jsxs(y,{children:[e.jsx(n,{label:"Total Enrollment",years:s,getValue:t=>r[t].metrics.totalEnrollment,format:"number"}),e.jsx(n,{label:"Returning Students",years:s,getValue:t=>r[t].metrics.returningStudents,format:"number"}),e.jsx(n,{label:"Retention Rate",years:s,getValue:t=>r[t].metrics.retentionRate,format:"percent"}),e.jsx(n,{label:"Internal Growth",years:s,getValue:t=>r[t].metrics.internalGrowth,format:"number"}),e.jsx(n,{label:"New Campus Growth",years:s,getValue:t=>r[t].metrics.newCampusGrowth,format:"number"}),e.jsx(n,{label:"Total New Students",years:s,getValue:t=>r[t].metrics.totalNewGrowth,format:"number"}),e.jsx(n,{label:"Non-Starters",years:s,getValue:t=>r[t].metrics.nonStarters,format:"number",invertColor:!0}),e.jsx(n,{label:"Mid-Year Withdrawals",years:s,getValue:t=>r[t].metrics.midYearWithdrawals,format:"number",invertColor:!0}),e.jsx(n,{label:"Net Growth",years:s,getValue:t=>r[t].metrics.netGrowth,format:"number"})]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.slice(1).map((t,o)=>{const x=r[t].metrics,h=r[s[o]].metrics,c=x.totalEnrollment-h.totalEnrollment,p=(c/h.totalEnrollment*100).toFixed(1);return e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(b,{className:"text-lg",children:[s[o]," â†’ ",t]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enrollment Growth"}),e.jsxs("p",{className:"text-2xl font-bold",children:[c>0?"+":"",u(c),e.jsxs("span",{className:"text-lg ml-2 text-muted-foreground",children:["(",p,"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Retention Rate"}),e.jsx("p",{className:"font-medium",children:R(x.retentionRate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Net Growth"}),e.jsx("p",{className:"font-medium",children:u(x.netGrowth)})]})]})]})]},t)})})]})}function n({label:m,years:l,getValue:i,format:a,invertColor:r=!1}){return e.jsxs(Y,{children:[e.jsx(C,{className:"font-medium",children:m}),l.map((d,s)=>{const t=i(d),o=s>0?i(l[s-1]):null,x=a==="percent"?R(t):u(t),h=o!==null?T(t,o):null,c=o!==null&&t>o,p=r?c?"text-red-500":"text-green-500":c?"text-green-500":"text-red-500";return e.jsxs(C,{className:"text-right",children:[e.jsx("span",{children:x}),h&&e.jsx("span",{className:`text-xs ml-2 ${p}`,children:h})]},d)})]})}function A(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(j,{className:"h-9 w-64"}),e.jsx(j,{className:"h-5 w-48 mt-2"})]}),e.jsx(j,{className:"h-[350px]"}),e.jsx(j,{className:"h-96"})]})}export{Z as YearOverYearPage};
